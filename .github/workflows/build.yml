# https://github.com/actions/setup-dotnet

name: Build

on: [ push, pull_request ]

env:
  DOTNET_SKIP_FIRST_TIME_EXPERIENCE: true
  MONO_TAG: "6.12.0.182"

jobs:

  build_and_test:
    name: Build & Test

    strategy:
      matrix:
        os: [ windows-latest, ubuntu-latest, macos-latest ]
      fail-fast: false

    runs-on: ${{ matrix.os }}

    steps:

      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Install .NET 6.0
        uses: actions/setup-dotnet@v2
        with:
          dotnet-version: 6.0.x

      # --------
      # Build
      # --------

      - name: Build All Target Frameworks
        run: |
          dotnet build ".\NHibernate.ObservableCollections.sln" --configuration Release

      # --------
      # Test
      # --------

      - name: Run .NET (net6.0) Unit Tests
        run: |
          dotnet test ".\NHibernate.ObservableCollections.sln" --configuration Release --framework net6.0 --no-build --logger "console;verbosity=detailed"

      - name: Run .NET Framework (net48) Unit Tests (Windows only)
        if: matrix.os == 'windows-latest'
        run: |
          dotnet test ".\NHibernate.ObservableCollections.sln" --configuration Release --framework net48 --no-build --logger "console;verbosity=detailed"

      - name: Run .NET Framework (net48) Unit Tests on Mono (Linux only)
        if: matrix.os == 'ubuntu-latest'
        run: |
          docker run --rm -v "$PWD":'/project' -w='/project' mono:$MONO_TAG bash -c 'mono ./bin/Release/net48/NHibernate.ObservableCollections.Tests/NHibernate.ObservableCollections.Tests.exe'



